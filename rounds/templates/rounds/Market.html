{{ block content }}

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="{{ static 'rounds/js/price_history.js' }}"></script>
<script src="{{ static 'rounds/js/market_page.js' }}"></script>

<link rel="stylesheet" href="{{ static 'rounds/css/market_page.css' }}">

<div class="layout-box">
        <div class="boxed_area vitals">
            <ul>
                <li> Period: {{ player.round_number}}
                <li> Current Cash: {{ player.cash }}
                <li> Number of Shares: {{ player.shares}}
            </ul>
        </div>

        <div class="chart-box boxed_area">
            <p class="box-header"> Market History</p>
            <div class="chart-history-area">
                <canvas id="gr_price" />
            </div>
            <div class="chart-volume-area">
                <canvas id="gr_volume" />
            </div>
        </div>

        <div class="message-box" >
            <!-- Current Market Price -->
            {{ if player.round_number != 1 }}
                <p class = "message"> Current Market Price: 
                <span class="bold-text"> {{price}} </span>
            {{ endif }}

            <!-- Margin Ratio Message (warning / error) -->
            {{if player.shares < 0 && personal_margin < .3}} 
                <div class="alert">
                <p class = "message"> 
                    Worth of Shares Relative to Cash Holdings:
                    <span class="bold-text"> {{personal_margin_pct}} </span>
                </p>
                </div>
            {{ endif  }}
            {{if player.shares < 0 && personal_margin > margin_target_ratio && personal_margin < margin_ratio}} 
                <div class="alert alert-warning">
                <p class = "message">
                    Warning, the value of the shares that you owe is 
                    <span class="bold-text"> {{personal_margin_pct}} </span>
                    of your cash holdings.  If that increases to {{ marg_ratio_pct }},
                    we will submit a buy order
                    on your behalf at {{ margin_premium_pct }} above the market price.
                </p>
                </div>
            {{ endif  }}
            {{if player.shares < 0 && personal_margin > margin_ratio}} 
                <div class="alert alert-danger">
                <p class = "message">
                    Warning, the value of the shares that you owe is 
                    <span class="bold-text"> {{personal_margin_pct}} </span>
                    of your cash holdings. 
                    You are advised to buy enough shares this round to avoid an
                    automatic buy-in.
                </p>
                </div>
            {{ endif  }}
        </div>

        <div class="order-form-box boxed_area">
            <div class="order-form">
                <div class="form-cell"> {{ formfield 'type' label='' }} </div>
                <div class="form-cell"> {{ formfield 'quantity' label='' }}  </div>
                <div class="form-cell"> @ </div>
                <div class="form-cell"> {{ formfield 'price' label=''}}  </div>
                <!--  <div class="form-cell"><button id="submit_btn" class="otree-btn-next btn btn-primary">Submit</button></div> -->
                <div class="form-cell"><div id="submit-btn" class="btn btn-primary" tabindex="0">Submit</div></div>
            </div>
        </div>
        
        <div class="orders-box boxed_area">
            <p class="box-header"> Outstanding Orders </p>
            <div id="order-list"/>
        </div>
        </div>
</div>
        {{ next_button }}
{{ endblock }}
